{% comment %}
  Section: Custom Granular Cookie Banner
  Style: Premium Beauty/Vogue Pink
  Features: Shopify Customer Privacy API (Granular)
{% endcomment %}

<div
  id="granular-cookie-banner"
  class="cookie-wrapper"
  style="display: none;">

  <div id="cookie-simple-view" class="cookie-glass-panel">
    <div class="cookie-content">
      <div class="cookie-icon">
        <svg
          width="24"
          height="24"
          viewBox="0 0 24 24"
          fill="none"
          stroke="#D81B60"
          stroke-width="2">
          <path
            d="M12 2a10 10 0 1 0 10 10 4 4 0 0 1-5-5 4 4 0 0 1-5-5zm0 0v.01M16 8h.01M8 16h.01M12 12h.01"
            stroke-linecap="round"
            stroke-linejoin="round" />
        </svg>
      </div>
      <div class="cookie-text">
        <h3>Cookie Consent</h3>
        <p>We use cookies to optimize your experience and deliver personalized content.
          <a href="/policies/privacy-policy">Read our Privacy Policy</a>
        </p>
      </div>
    </div>
    <div class="cookie-actions">
      <button id="btn-open-prefs" class="btn-link">Manage Preferences</button>
      <button id="btn-accept-all" class="btn-primary">Accept</button>
    </div>
  </div>

  <div
    id="cookie-granular-view"
    class="cookie-glass-panel granular-modal"
    style="display: none;">
    <div class="granular-header">
      <h3>Customize Consent</h3>
      <button id="btn-close-prefs" class="btn-close">âœ•</button>
    </div>

    <div class="granular-body">

      <div class="consent-row">
        <div class="consent-info">
          <span class="consent-title">Required</span>
          <span class="consent-desc">These cookies are necessary for the site to function properly, including capabilities like logging in and adding items to the cart.</span>
        </div>
        <div class="toggle-switch disabled">
          <input
            type="checkbox"
            checked
            disabled>
          <span class="slider"></span>
        </div>
      </div>

      <div class="consent-row">
        <div class="consent-info">
          <span class="consent-title">Personalization</span>
          <span class="consent-desc">These cookies store details about your actions to personalize your next visit to the website.</span>
        </div>
        <label class="toggle-switch">
          <input type="checkbox" id="consent-preferences">
          <span class="slider"></span>
        </label>
      </div>

      <div class="consent-row">
        <div class="consent-info">
          <span class="consent-title">Marketing</span>
          <span class="consent-desc">These cookies are used by us and our partners, including Shopify, to optimize marketing communications and show you ads on other websites.</span>
        </div>
        <label class="toggle-switch">
          <input type="checkbox" id="consent-marketing">
          <span class="slider"></span>
        </label>
      </div>

      <div class="consent-row">
        <div class="consent-info">
          <span class="consent-title">Analytics</span>
          <span class="consent-desc">These cookies help us understand how you interact with the site. We use this data to identify areas to improve.</span>
        </div>
        <label class="toggle-switch">
          <input type="checkbox" id="consent-analytics">
          <span class="slider"></span>
        </label>
      </div>

    </div>

    <div class="granular-footer">
      <button id="btn-decline-all" class="btn-outline">Decline All</button>
      <button id="btn-save-prefs" class="btn-primary">Save Preferences</button>
    </div>
  </div>

</div>

<style>
  /* --- CSS: Beauty Glassmorphism Theme --- */
  .cookie-wrapper {
    position: fixed;
    bottom: 24px;
    right: 24px;
    /* Posisi Kanan Bawah */
    z-index: 2147483647;
    /* Paling atas */
    font-family: 'Assistant'
    , sans-serif;
    /* Sesuaikan dengan font tema Anda */
  }

  /* Panel Utama (Glass Effect) */
  .cookie-glass-panel {
    background: rgba(255, 245, 247, 0.98);
    /* Pink Glass Opaque */
    backdrop-filter: blur(16px);
    -webkit-backdrop-filter: blur(16px);
    border: 1px solid rgba(255, 209, 220, 0.8);
    box-shadow: 0 15px 40px rgba(189, 49, 90, 0.15);
    border-radius: 16px;
    padding: 24px;
    width: 380px;
    max-width: 90vw;
    animation: slideUp 0.5s cubic-bezier(0.2, 0.8, 0.2, 1);
  }

  /* Simple View Styling */
  .cookie-content {
    display: flex;
    gap: 16px;
    margin-bottom: 20px;
    align-items: flex-start;
  }
  .cookie-text h3 {
    margin: 0 0 6px;
    color: #880E4F;
    font-size: 16px;
    font-weight: 700;
    font-family: 'Playfair Display'
    , serif;
  }
  .cookie-text p {
    margin: 0;
    font-size: 13px;
    color: #5D4037;
    line-height: 1.5;
  }
  .cookie-text a {
    color: #D81B60;
    text-decoration: underline;
    transition: color 0.2s;
  }
  .cookie-text a:hover {
    color: #880E4F;
  }

  .cookie-actions {
    display: flex;
    gap: 12px;
    justify-content: flex-end;
    align-items: center;
  }

  /* Buttons */
  .btn-primary {
    background: #D81B60;
    color: white;
    border: none;
    padding: 12px 24px;
    border-radius: 50px;
    font-weight: 600;
    font-size: 12px;
    cursor: pointer;
    text-transform: uppercase;
    letter-spacing: 1px;
    transition: all 0.2s ease;
    box-shadow: 0 4px 10px rgba(216, 27, 96, 0.2);
  }
  .btn-primary:hover {
    background: #AD1457;
    transform: translateY(-1px);
    box-shadow: 0 6px 15px rgba(216, 27, 96, 0.3);
  }

  .btn-outline {
    background: transparent;
    color: #D81B60;
    border: 1px solid #D81B60;
    padding: 11px 20px;
    border-radius: 50px;
    font-weight: 600;
    font-size: 12px;
    cursor: pointer;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    transition: all 0.2s;
  }
  .btn-outline:hover {
    background: #FFF0F5;
  }

  .btn-link {
    background: none;
    border: none;
    color: #9E9E9E;
    text-decoration: underline;
    font-size: 12px;
    cursor: pointer;
    margin-right: auto;
    padding: 0;
  }
  .btn-link:hover {
    color: #616161;
  }
  .btn-close {
    background: none;
    border: none;
    font-size: 20px;
    cursor: pointer;
    color: #D81B60;
    line-height: 1;
  }

  /* Granular Modal Styling */
  .granular-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 20px;
    border-bottom: 1px solid #FFD1DC;
    padding-bottom: 15px;
  }
  .granular-header h3 {
    margin: 0;
    color: #880E4F;
    font-size: 18px;
    font-family: 'Playfair Display'
    , serif;
  }

  .granular-body {
    max-height: 350px;
    overflow-y: auto;
    padding-right: 5px;
  }
  /* Scrollbar cantik */
  .granular-body::-webkit-scrollbar {
    width: 4px;
  }
  .granular-body::-webkit-scrollbar-thumb {
    background-color: #FFD1DC;
    border-radius: 4px;
  }

  .consent-row {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    margin-bottom: 20px;
    gap: 15px;
  }
  .consent-info {
    flex: 1;
  }
  .consent-title {
    display: block;
    font-weight: 700;
    font-size: 14px;
    color: #4A4A4A;
    margin-bottom: 4px;
  }
  .consent-desc {
    display: block;
    font-size: 12px;
    color: #795548;
    line-height: 1.4;
  }

  .granular-footer {
    display: flex;
    gap: 10px;
    justify-content: flex-end;
    margin-top: 20px;
    border-top: 1px solid #FFD1DC;
    padding-top: 20px;
  }

  /* Toggle Switch (Pink Beauty Style) */
  .toggle-switch {
    position: relative;
    display: inline-block;
    width: 44px;
    height: 24px;
    flex-shrink: 0;
  }
  .toggle-switch input {
    opacity: 0;
    width: 0;
    height: 0;
  }

  .slider {
    position: absolute;
    cursor: pointer;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background-color: #E0E0E0;
    transition: 0.4s;
    border-radius: 34px;
  }
  .slider:before {
    position: absolute;
    content: "";
    height: 18px;
    width: 18px;
    left: 3px;
    bottom: 3px;
    background-color: white;
    transition: 0.4s;
    border-radius: 50%;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
  }

  input:checked + .slider {
    background-color: #D81B60;
  }
  input:checked + .slider:before {
    transform: translateX(20px);
  }

  /* Disabled State for Required */
  .toggle-switch.disabled {
    pointer-events: none;
  }
  .toggle-switch.disabled .slider {
    background-color: #F8BBD0;
    opacity: 0.6;
  }
  .toggle-switch.disabled input:checked + .slider {
    background-color: #D81B60;
    opacity: 0.5;
  }

  /* Mobile Responsive */
  @media (max-width: 480px) {
    .cookie-glass-panel {
      width: 100%;
      bottom: 0;
      right: 0;
      left: 0;
      border-radius: 16px 16px 0 0;
      max-width: 100%;
    }
    .cookie-wrapper {
      bottom: 0;
      right: 0;
      left: 0;
      width: 100%;
    }
    .cookie-content {
      flex-direction: row;
    }
  }

  @keyframes slideUp {
    from {
      transform: translateY(50px);
      opacity: 0;
    }
    to {
      transform: translateY(0);
      opacity: 1;
    }
  }
</style>

<script>
  document.addEventListener("DOMContentLoaded", function() {
    const bannerWrapper = document.getElementById('granular-cookie-banner');
    const simpleView = document.getElementById('cookie-simple-view');
    const granularView = document.getElementById('cookie-granular-view');

    // 1. Inisialisasi API Shopify & Cek Status
    function init() {
      // Tunggu API Consent siap
      window.Shopify.loadFeatures(
        [{ name: 'consent-tracking-api', version: '0.1' }],
        function (error) {
          if (error) {
            console.error('Consent API Error:', error);
            return;
          }
          
          const status = window.Shopify.customerPrivacy.getTrackingConsent();
          // Tampilkan banner HANYA JIKA user belum pernah memilih ('no_interaction')
          if (status === 'no_interaction') {
            bannerWrapper.style.display = 'block';
          }
        }
      );
    }
    
    // Jalankan Init
    init();

    // 2. Fungsi Utama Set Consent (Granular)
    function setConsent(analytics, marketing, preferences) {
      window.Shopify.customerPrivacy.setTrackingConsent(
        {
          analytics: analytics,
          marketing: marketing,
          preferences: preferences, // Kategori Personalization
          sale_of_data: marketing   // Biasanya disamakan dengan Marketing (CCPA)
        },
        function() {
          console.log('Consent Saved:', { analytics, marketing, preferences });
          // Sembunyikan banner dengan animasi fade out (opsional) atau langsung
          bannerWrapper.style.display = 'none';
        }
      );
    }

    // 3. Logic Tombol

    // A. ACCEPT ALL (Aktifkan Semua 3 Kategori)
    document.getElementById('btn-accept-all').addEventListener('click', () => {
      setConsent(true, true, true);
    });

    // B. DECLINE ALL (Matikan Semua, hanya Required yg sisa)
    document.getElementById('btn-decline-all').addEventListener('click', () => {
      setConsent(false, false, false);
    });

    // C. SAVE PREFERENCES (Baca status 3 Toggle)
    document.getElementById('btn-save-prefs').addEventListener('click', () => {
      const isPreferences = document.getElementById('consent-preferences').checked;
      const isMarketing = document.getElementById('consent-marketing').checked;
      const isAnalytics = document.getElementById('consent-analytics').checked;
      
      setConsent(isAnalytics, isMarketing, isPreferences);
    });

    // 4. Navigasi UI (Buka/Tutup Modal Granular)
    document.getElementById('btn-open-prefs').addEventListener('click', () => {
      simpleView.style.display = 'none';
      granularView.style.display = 'block';
    });

    document.getElementById('btn-close-prefs').addEventListener('click', () => {
      granularView.style.display = 'none';
      simpleView.style.display = 'block';
    });
  });
</script>

{% schema %}
  {
    "name": "Custom Cookie Banner",
    "settings": [],
    "presets": [
      {
        "name": "Custom Cookie Banner"
      }
    ]
  }
{% endschema %}