{% comment %}
  Section: Text List (Block Based)
  Description: A flowing list of text items separated by dots.
  Supports "Connect Dynamic Source" on each block for maximum flexibility.
{% endcomment %}

{%- style -%}
  .section-{{ section.id }}-padding {
    padding-top: {{ section.settings.padding_top | times: 0.75 | round: 0 }}px;
    padding-bottom: {{ section.settings.padding_bottom | times: 0.75 | round: 0 }}px;
    background-color: transparent;
  }
  .concerns-list__container {
    max-width: {{ section.settings.max_width }}px;
    margin: 0 auto;
    padding-left: 1.5rem;
    padding-right: 1.5rem;
    text-align: {{ section.settings.text_align }};
    font-size: {{ section.settings.font_size }}px;
    line-height: 1.6;
    color: {{ section.settings.text_color }};
  }
  @media screen and (min-width: 750px) {
    .section-{{ section.id }}-padding {
      padding-top: {{ section.settings.padding_top }}px;
      padding-bottom: {{ section.settings.padding_bottom }}px;
    }
    .concerns-list__container {
      text-align: center;
    }
  }

  /* The bold label at the start */
  .concerns-list__label {
    display: inline;
    font-weight: 700;
    margin-right: 0.3em;
    color: {{ section.settings.heading_color }};
  }

  /* The individual list items */
  .concerns-list__item {
    display: inline;
    font-weight: 300;
    color: #6c7256;
  }

  /* The separator dot */
  .concerns-list__separator {
    display: inline-block;
    margin: 0 0.1em;
    font-weight: 400;
  }
{%- endstyle -%}

{% if product.metafields.custom.concerns != blank %}
  <div class="section-{{ section.id }}-padding">
    <div class="concerns-list__container">

      {%- if section.settings.label != blank -%}
        <span class="concerns-list__label">{{ section.settings.label }}</span>
    {%- endif -%}

      {% comment %} 
                CHANGED: We capture the raw array value to prevent Shopify from stringifying it 
            {% endcomment %}
      {% assign concerns_list = product.metafields.custom.concerns.value %}

      {%- for item in concerns_list -%}
        <span class="concerns-list__item">
          {{ item }}
        </span>

        {%- unless forloop.last -%}
          <span class="concerns-list__separator">
            {% if section.settings.separator != blank %}
              {{ section.settings.separator }}
            {% else %}
              â€¢
            {% endif %}
          </span>
        {%- endunless -%}
      {%- endfor -%}

    </div>
  </div>
{% endif %}

{% schema %}
  {
    "name": "Text List / Concerns",
    "tag": "section",
    "class": "section",
    "settings": [
      {
        "type": "text",
        "id": "label",
        "label": "Label",
        "default": "Concerns:"
      },
      {
        "type": "header",
        "content": "Style"
      },
      {
        "type": "color",
        "id": "bg_color",
        "label": "Background Color",
        "default": "#fbfbf9"
      },
      {
        "type": "color",
        "id": "heading_color",
        "label": "Label Color",
        "default": "#5e6d55"
      }, {
        "type": "color",
        "id": "text_color",
        "label": "Text Color",
        "default": "#757575"
      }, {
        "type": "range",
        "id": "font_size",
        "min": 12,
        "max": 30,
        "step": 1,
        "unit": "px",
        "label": "Font Size",
        "default": 14
      }, {
        "type": "select",
        "id": "text_align",
        "label": "Alignment",
        "options": [
          {
            "value": "left",
            "label": "Left"
          }, {
            "value": "center",
            "label": "Center"
          }, {
            "value": "right",
            "label": "Right"
          }
        ],
        "default": "center"
      }, {
        "type": "range",
        "id": "max_width",
        "min": 300,
        "max": 1200,
        "step": 20,
        "unit": "px",
        "label": "Max Width",
        "default": 800
      }, {
        "type": "header",
        "content": "Padding"
      }, {
        "type": "range",
        "id": "padding_top",
        "min": 0,
        "max": 100,
        "step": 4,
        "unit": "px",
        "label": "Top padding",
        "default": 20
      }, {
        "type": "range",
        "id": "padding_bottom",
        "min": 0,
        "max": 100,
        "step": 4,
        "unit": "px",
        "label": "Bottom padding",
        "default": 20
      }
    ],
    "blocks": [
      {
        "type": "item",
        "name": "Text Item",
        "settings": [
          {
            "type": "inline_richtext",
            "id": "text",
            "label": "Text",
            "default": "Item Name",
            "info": "Connects to Single Line Text or Rich Text Metafields (One Value only)."
          }
        ]
      }
    ],
    "presets": [
      {
        "name": "Text List / Concerns",
        "blocks": [
          {
            "type": "item",
            "settings": {
              "text": "Low energy"
            }
          }, {
            "type": "item",
            "settings": {
              "text": "Morning fatigue"
            }
          }, {
            "type": "item",
            "settings": {
              "text": "Brain fog"
            }
          }
        ]
      }
    ]
  }
{% endschema %}