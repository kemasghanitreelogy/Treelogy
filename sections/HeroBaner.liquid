<section
  id="hero-{{ section.id }}"
  class="hero-section"
  style="margin-top: {{ section.settings.margin_top }}px; margin-bottom: {{ section.settings.margin_bottom }}px;">

  <div class="hero-container">
    {% if section.settings.image != blank %}
      <picture>
        {% if section.settings.image_mobile != blank %}
          <source
            media="(max-width: 767px)"
            srcset="
              {{ section.settings.image_mobile | image_url: width: 400 }} 400w,
              {{ section.settings.image_mobile | image_url: width: 600 }} 600w,
              {{ section.settings.image_mobile | image_url: width: 800 }} 800w
            "
            sizes="100vw">
        {% endif %}
        <img
          src="{{ section.settings.image | image_url: width: 1920 }}"
          srcset="
            {{ section.settings.image | image_url: width: 800 }} 800w,
            {{ section.settings.image | image_url: width: 1200 }} 1200w,
            {{ section.settings.image | image_url: width: 1600 }} 1600w,
            {{ section.settings.image | image_url: width: 2000 }} 2000w
          "
          sizes="100vw"
          alt="{{ section.settings.alt | escape }}"
          {% if section.settings.loading_priority %}
          fetchpriority="high"
          {% else %}
          loading="lazy"
          {% endif %}
          width="{{ section.settings.image.width }}"
          height="{{ section.settings.image.height }}"
          class="hero-image">
      </picture>
    {% else %}
      <div class="hero-placeholder">
        {{ 'image' | placeholder_svg_tag }}
      </div>
    {% endif %}

    {% if section.settings.title != blank or section.settings.content != blank %}
      <div class="hero-text-overlay hero-text-{{ section.settings.text_position }}">
        {% if section.settings.title != blank %}
          <h1 class="hero-title">{{ section.settings.title }}</h1>
        {% endif %}
        {% if section.settings.content != blank %}
          <div class="hero-content">{{ section.settings.content }}</div>
        {% endif %}
      </div>
    {% endif %}
  </div>

  {% if section.settings.show_countdown %}
    <div class="countdown-wrapper-{{ section.id }}" style="position: relative;">

      <div id="countdown-anchor-{{ section.id }}" style="position: absolute; top: -{{ section.settings.sticky_top_offset }}px; width: 100%; height: 1px; visibility: hidden; pointer-events: none;"></div>

      <div class="countdown-overlay" id="countdown-bar-{{ section.id }}">
        <div class="countdown-container" data-end-date="{{ section.settings.countdown_date }}">
        <div class="countdown-text">
          <span class="countdown-hours">00</span>:<span class="countdown-minutes">00</span>:<span class="countdown-seconds">00</span>&nbsp;{{ section.settings.countdown_message }}
        </div>
        </div>
      </div>

      <div id="countdown-spacer-{{ section.id }}" style="display: none; width: 100%;"></div>
    </div>
  {% endif %}
</section>

{% schema %}
  {
    "name": "Hero Image Only",
    "settings": [
      {
        "type": "image_picker",
        "id": "image",
        "label": "Desktop image"
      },
      {
        "type": "image_picker",
        "id": "image_mobile",
        "label": "Mobile image (optional)"
      },
      {
        "type": "text",
        "id": "alt",
        "label": "Image alt text",
        "default": "Hero image"
      },
      {
        "type": "checkbox",
        "id": "loading_priority",
        "label": "High priority loading (above the fold)",
        "default": true,
        "info": "Enable for hero images visible on page load"
      }, {
        "type": "header",
        "content": "Text Overlay"
      }, {
        "type": "text",
        "id": "title",
        "label": "Title",
        "default": "Hero Title"
      }, {
        "type": "richtext",
        "id": "content",
        "label": "Content",
        "default": "<p>Add your hero content here</p>"
      }, {
        "type": "select",
        "id": "text_position",
        "label": "Text Position",
        "options": [
          {
            "value": "top-left",
            "label": "Top Left"
          },
          {
            "value": "top-right",
            "label": "Top Right"
          },
          {
            "value": "center",
            "label": "Center"
          },
          {
            "value": "bottom-left",
            "label": "Bottom Left"
          }, {
            "value": "bottom-right",
            "label": "Bottom Right"
          }
        ],
        "default": "center"
      }, {
        "type": "header",
        "content": "Countdown Timer"
      }, {
        "type": "checkbox",
        "id": "show_countdown",
        "label": "Show countdown timer",
        "default": false
      }, 
      /* Labels removed from Schema usage but kept here to avoid breaking existing settings data */
      {
        "type": "text",
        "id": "day_label",
        "label": "Day Label (Not used in H:M:S format)",
        "default": "hari"
      }, {
        "type": "text",
        "id": "hour_label",
        "label": "Hour Label (Not used in H:M:S format)",
        "default": "jam"
      }, 
      {
        "type": "text",
        "id": "countdown_date",
        "label": "Countdown end date",
        "info": "Format: YYYY-MM-DD HH:MM (e.g., 2024-12-31 23:59)",
        "default": "2024-12-31 23:59"
      }, {
        "type": "text",
        "id": "countdown_message",
        "label": "Countdown message",
        "default": "Hanya menerima 100 pesanan"
      }, {
        "type": "header",
        "content": "Sticky Settings"
      }, {
        "type": "checkbox",
        "id": "enable_sticky",
        "label": "Enable Sticky on Scroll",
        "default": true
      }, {
        "type": "range",
        "id": "sticky_top_offset",
        "min": 0,
        "max": 200,
        "step": 5,
        "unit": "px",
        "label": "Sticky Top Offset",
        "default": 0,
        "info": "Adjust this to match your header height."
      }, {
        "type": "header",
        "content": "Spacing"
      }, {
        "type": "range",
        "id": "margin_top",
        "min": 0,
        "max": 200,
        "step": 10,
        "unit": "px",
        "label": "Margin Top",
        "default": 0
      }, {
        "type": "range",
        "id": "margin_bottom",
        "min": 0,
        "max": 200,
        "step": 10,
        "unit": "px",
        "label": "Margin Bottom",
        "default": 0
      }
    ],
    "presets": [
      {
        "name": "Hero Image Only"
      }
    ]
  }
{% endschema %}

<script>
  (function() {
    // --- 1. Countdown Timer Logic ---
    const countdownEl = document.querySelector('#hero-{{ section.id }} .countdown-container');
    
    if (countdownEl) {
      const endDate = new Date(countdownEl.dataset.endDate).getTime();
      
      // Selectors updated for Hours, Minutes, Seconds
      const hoursEl = countdownEl.querySelector('.countdown-hours');
      const minutesEl = countdownEl.querySelector('.countdown-minutes');
      const secondsEl = countdownEl.querySelector('.countdown-seconds');
      
      function updateCountdown() {
        const now = new Date().getTime();
        const distance = endDate - now;
        
        if (distance < 0) {
          hoursEl.textContent = '00';
          minutesEl.textContent = '00';
          secondsEl.textContent = '00';
          return;
        }
        
        // Calculate Time
        // Hours: Total hours (including days)
        const hours = Math.floor(distance / (1000 * 60 * 60));
        // Minutes: Remainder after hours removed
        const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
        // Seconds: Remainder after minutes removed
        const seconds = Math.floor((distance % (1000 * 60)) / 1000);
        
        // Update DOM
        hoursEl.textContent = String(hours).padStart(2, '0');
        minutesEl.textContent = String(minutes).padStart(2, '0');
        secondsEl.textContent = String(seconds).padStart(2, '0');
      }
      
      updateCountdown();
      // UPDATED: Interval set to 1000ms (1 second) instead of 60000ms
      setInterval(updateCountdown, 1000); 
    }

    // --- 2. Smoother Sticky Logic (No Blinking) ---
    {% if section.settings.enable_sticky %}
      const anchor = document.getElementById("countdown-anchor-{{ section.id }}");
      const bar = document.getElementById("countdown-bar-{{ section.id }}");
      const spacer = document.getElementById("countdown-spacer-{{ section.id }}");
      const offset = {{ section.settings.sticky_top_offset | default: 0 }};

      if (anchor && bar && spacer) {
        
        function onScroll() {
          const rect = anchor.getBoundingClientRect();
          
          if (rect.top <= 0) {
             if (!bar.classList.contains('sticky-fixed')) {
               spacer.style.height = bar.offsetHeight + 'px';
               spacer.style.display = 'block';
               
               bar.classList.add('sticky-fixed');
               bar.style.top = offset + 'px';
             }
          } else {
             if (bar.classList.contains('sticky-fixed')) {
               bar.classList.remove('sticky-fixed');
               bar.style.top = 'auto';
               
               spacer.style.display = 'none';
               spacer.style.height = '0px';
             }
          }
        }

        let ticking = false;
        window.addEventListener('scroll', function() {
          if (!ticking) {
            window.requestAnimationFrame(function() {
              onScroll();
              ticking = false;
            });
            ticking = true;
          }
        }, { passive: true });
        
        window.addEventListener('resize', onScroll);
      }
    {% endif %}
  })();
</script>

{% stylesheet %}
  .hero-section .hero-container {
    position: relative;
    width: 100%;
  }

  .hero-section
  .hero-image {
    width: 100%;
    display: block;
    height: auto;
    object-fit: cover;
  }

  .hero-section
  .hero-placeholder {
    width: 100%;
    height: 400px;
    background: #f4f4f4;
  }

  .hero-section
  .hero-text-overlay {
    position: absolute;
    padding: 2rem;
    color: white;
    width: 229px;
    color: #2b3c35;
  }

  .hero-section .hero-text-top-left { top: 0; left: 0; }
  .hero-section .hero-text-top-right { top: 30px; right: 11px; text-align: right; }
  .hero-section .hero-text-center { top: 50%; left: 50%; transform: translate(-50%, -50%); text-align: center; }
  .hero-section .hero-text-bottom-left { bottom: 0; left: 0; }
  .hero-section .hero-text-bottom-right { bottom: 0; right: 0; text-align: right; }

  .hero-section .hero-title { font-size: 18px; font-weight: 600; text-align: center; }
  .hero-section .hero-content { font-size: 14px; font-weight: 300; text-align: center; }

  .hero-section .countdown-container {
    background-color: #a6bb87;
    width: 100%;
    margin: 0 auto;
    padding: 15px 0;
    transition: none;
  }

  .hero-section .countdown-overlay {
    width: 100%;
    z-index: 999;
    transition: none;
  }

  /* Fixed State */
  .hero-section .countdown-overlay.sticky-fixed {
    position: fixed;
    z-index: 1;
    left: 0;
    right: 0;
    width: 100%;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    animation: slideDown 0.3s ease-out forwards;
  }

  @keyframes slideDown {
    from { transform: translateY(-100%); opacity: 0; }
    to { transform: translateY(0); opacity: 1; }
  }

  .hero-section .countdown-text {
    color: #ffffff;
    font-size: 13px;
    font-weight: 600;
    text-align: center;
    /* Ensure numbers don't jump around */
    font-variant-numeric: tabular-nums; 
  }

  @media (min-width: 380px) {
    .hero-section .countdown-text { font-size: 13px; }
  }

  @media (min-width: 768px) {
    .hero-section .hero-text-overlay { padding: 1.5rem; max-width: 90%; }
  }
  @media (min-width: 1024px) {
    .hero-section .hero-title { font-size: 36px; }
    .hero-section .hero-content { font-size: 24px; }
    .hero-section .hero-text-overlay { position: absolute; padding: 2rem; color: white; width: 319px; color: #2b3c35; }
    .hero-section .hero-text-top-right { top: 40px; right: 130px; text-align: right; }
    .hero-section .countdown-text { font-size: 16px; }
  }
{% endstylesheet %}