{% assign should_be_showed = false %}
{% for block in section.blocks %}
  {% if block.settings.title != blank %}
    {% assign should_be_showed = true %}
    {% break %}
  {% endif %}{% endfor %}

{%- assign mt = section.settings.margin_top_mobile -%}
{%- assign mb = section.settings.margin_bottom_mobile -%}

<style>
  /* Mobile (Base) */
  #shopify-section-{{ section.id }} {
    margin-top: {{ mt }}px;
    margin-bottom: {{ mb }}px;
  }

  /* Tablet */
  @media only screen and (min-width: 768px) {
    #shopify-section-{{ section.id }} {
      margin-top: {{ mt | times: 1.5 | round }}px;
      margin-bottom: {{ mb | times: 1.5 | round }}px;
    }
  }

  /* Desktop */
  @media only screen and (min-width: 1024px) {
    #shopify-section-{{ section.id }} {
      margin-top: {{ mt | times: 2 | round }}px;
      margin-bottom: {{ mb | times: 2 | round }}px;
    }
  }
</style>

{% unless should_be_showed %}
  <style>
    #shopify-section-{{ section.id }} {
      display: none;
    }
  </style>
{% endunless %}

<style>
  .title-section-accordion {
    font-size: 24px !important;
    font-weight: 600 !important;
  }
  .accordion-toggle-checkbox {
    display: none;
  }

  /* 2. By default, hide items that have the 'extended-item' class */
  .accordion-list-item.extended-item {
    display: none;
  }

  .accordion-list.accordion-list-section {
    padding: 0 !important;
  }

  @media only screen and (max-width: 900px) {
    .accordion-list.accordion-list-section {
      padding: 0 !important;
    }
  }
  #Accordion-{{ section.id }}
  .scroll-container .accordion-header h2 {
    font-size: 16px;
    font-weight: {{ section.settings.accordion_header_weight }};
    color: #567350;
    line-height: 25px;
    margin-bottom: 0;
    margin-right: 30px;
  }

  /* 3. When checkbox is CHECKED, show the extended items */
  .accordion-toggle-checkbox:checked ~ .scroll-container .accordion-list-item.extended-item {
    display: block;
    animation: fadeIn 0.5s ease;
  }

  /* 4. TOGGLE LOGIC FOR BUTTON TEXT */
  .text-less {
    display: none;
  }
  .text-more {
    display: inline;
  }

  .accordion-toggle-checkbox:checked ~ .see-more-label .text-more {
    display: none;
  }
  .accordion-toggle-checkbox:checked ~ .see-more-label .text-less {
    display: inline;
  }

  /* Animation */
  @keyframes fadeIn {
    from {
      opacity: 0;
    }
    to {
      opacity: 1;
    }
  }

  .see-more-label {
    margin-top: 20px;
    text-align: left;
    text-decoration: underline;
    cursor: pointer;
    display: inline-block;
    user-select: none;
    color: #567350;
    font-size: 16px;
  }

  /* 5. ICON STYLING */
  /* Ensure the SVG (default or custom) stays a consistent size */.accordion-header svg {
    width: 12px;
    height: 12px;
    flex-shrink: 0;
    /* Prevents icon from squishing if title is long */
  }
</style>

<div class="main-grid" id="Accordion-{{ section.id }}">
  <div class="left-content">
    <h2 class="title-section-accordion" style="color: {{ section.settings.heading_color }};">
      {{ section.settings.title }}
    </h2>

    {% render 'PrimaryButton'
      , url: section.settings.button_url
      , title: section.settings.button_label
      , type: 'transparent'
    %}
  </div>

  <div class="right-list">

    {% assign limit = section.settings.limit_count | default: 5 %}

    <input
      type="checkbox"
      id="ShowMore-{{ section.id }}"
      class="accordion-toggle-checkbox">

    <div class="scroll-container __accordion">
      {% for block in section.blocks %}

        {% assign is_extended = false %}
        {% if forloop.index > limit %}
          {% assign is_extended = true %}
        {% endif %}

        <div class="accordion __accordion-wrapper accordion-list-item {% if is_extended %}extended-item{% endif %}">
          <div class="accordion-header __accordion-button">
            <h2 class="text-start py-2 text-2xl md:text-4xl">
              {{ block.settings.title }}
            </h2>

            {% comment %} RENDER ICON: Custom or Default {% endcomment %}
            {% if section.settings.custom_icon != blank %}
              {{ section.settings.custom_icon }}
            {% else %}
              <svg
                xmlns="http://www.w3.org/2000/svg"
                fill="none"
                viewBox="0 0 12 12">
                <path fill="#2B3C35" d="M7 5V0H5v5H0v2h5v5h2V7h5V5H7Z" />
              </svg>
            {% endif %}

          </div>
          <div class="accordion-description __accordion-content" style="color: {{ section.settings.accordion_text_color }};">
            {{ block.settings.description }}
          </div>
        </div>
      {% endfor %}
    </div>

    {% if section.blocks.size > limit %}
      <label for="ShowMore-{{ section.id }}" class="see-more-label">
        <span class="text-more">{{ section.settings.see_more_label | default: 'See More' }}</span>
        <span class="text-less">{{ section.settings.see_less_label | default: 'See Less' }}</span>
      </label>
    {% endif %}

  </div>
</div>

{% schema %}
  {
    "name": "Accordion",
    "tag": "section",
    "class": "section accordion-list accordion-list-section",
    "settings": [
      {
        "type": "header",
        "content": "Section Spacing"
      },
      {
        "type": "paragraph",
        "content": "Settings apply to Mobile. Tablet scales by 1.5x, Desktop scales by 2x."
      },
      {
        "type": "range",
        "id": "margin_top_mobile",
        "min": 0,
        "max": 100,
        "step": 4,
        "unit": "px",
        "label": "Margin Top (Mobile)",
        "default": 32
      },
      {
        "type": "range",
        "id": "margin_bottom_mobile",
        "min": 0,
        "max": 100,
        "step": 4,
        "unit": "px",
        "label": "Margin Bottom (Mobile)",
        "default": 32
      }, {
        "type": "header",
        "content": "Content Settings"
      }, {
        "type": "text",
        "id": "title",
        "label": "Title"
      }, {
        "type": "color",
        "id": "heading_color",
        "label": "Heading Color",
        "default": "#6c7256"
      }, {
        "type": "header",
        "content": "Icon Settings"
      }, {
        "type": "html",
        "id": "custom_icon",
        "label": "Custom SVG Icon",
        "info": "Paste your SVG code here (e.g., <svg...>...</svg>). Leave blank to use the default Plus icon."
      }, {
        "type": "header",
        "content": "List Settings"
      }, {
        "type": "select",
        "id": "accordion_header_weight",
        "label": "Header Font Weight",
        "options": [
          {
            "value": "300",
            "label": "Light (300)"
          },
          {
            "value": "400",
            "label": "Normal (400)"
          },
          {
            "value": "500",
            "label": "Medium (500)"
          },
          {
            "value": "600",
            "label": "Semi-bold (600)"
          }, {
            "value": "700",
            "label": "Bold (700)"
          }, {
            "value": "800",
            "label": "Extra Bold (800)"
          }, {
            "value": "900",
            "label": "Black (900)"
          }
        ],
        "default": "500"
      }, {
        "type": "range",
        "id": "limit_count",
        "min": 1,
        "max": 20,
        "step": 1,
        "label": "Items to show initially",
        "default": 5
      }, {
        "type": "text",
        "id": "see_more_label",
        "label": "Expand Button Label",
        "default": "See More"
      }, {
        "type": "text",
        "id": "see_less_label",
        "label": "Collapse Button Label",
        "default": "See Less"
      }, {
        "type": "header",
        "content": "Button"
      }, {
        "type": "text",
        "id": "button_label",
        "label": "Button label"
      }, {
        "type": "url",
        "id": "button_url",
        "label": "Button url"
      }
    ],
    "blocks": [
      {
        "type": "text",
        "name": "List",
        "settings": [
          {
            "type": "text",
            "id": "title",
            "label": "Title"
          }, {
            "type": "richtext",
            "id": "description",
            "label": "Description"
          }, {
            "type": "color",
            "id": "accordion_text_color",
            "label": "Accordion Text Color",
            "default": "#567350"
          }
        ]
      }
    ],
    "presets": [
      {
        "name": "Accordion List"
      }
    ]
  }
{% endschema %}